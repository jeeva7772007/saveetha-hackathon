<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MediTriageAI — Sign In</title>
    <meta name="description"
        content="Sign in or create an account to access MediTriageAI and view your analysis history." />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <div class="bg-orb orb-1"></div>
    <div class="bg-orb orb-2"></div>
    <div class="bg-orb orb-3"></div>

    <div class="auth-page">
        <!-- Logo -->
        <div class="auth-logo">
            <div class="logo-icon">
                <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="20" cy="20" r="20" fill="url(#lg2)" />
                    <path d="M20 10v20M10 20h20" stroke="white" stroke-width="3.5" stroke-linecap="round" />
                    <defs>
                        <linearGradient id="lg2" x1="0" y1="0" x2="40" y2="40" gradientUnits="userSpaceOnUse">
                            <stop stop-color="#06b6d4" />
                            <stop offset="1" stop-color="#6366f1" />
                        </linearGradient>
                    </defs>
                </svg>
            </div>
            <span class="logo-title">MediTriageAI</span>
        </div>

        <div class="auth-card">
            <!-- Tabs -->
            <div class="auth-tabs">
                <button class="auth-tab active" id="tabSignin" onclick="switchTab('signin')">Sign In</button>
                <button class="auth-tab" id="tabSignup" onclick="switchTab('signup')">Create Account</button>
            </div>

            <!-- Sign In Form -->
            <form id="signinForm" class="auth-form" onsubmit="handleSignIn(event)">
                <h2 class="auth-title">Welcome back</h2>
                <p class="auth-sub">Sign in to view your analysis history</p>
                <div class="auth-field">
                    <label for="siEmail">Email</label>
                    <input type="email" id="siEmail" placeholder="you@example.com" required autocomplete="email" />
                </div>
                <div class="auth-field">
                    <label for="siPassword">Password</label>
                    <input type="password" id="siPassword" placeholder="••••••••" required
                        autocomplete="current-password" />
                </div>
                <div class="auth-error" id="siError"></div>
                <button type="submit" class="auth-btn" id="siBtn">
                    <span id="siBtnText">Sign In</span>
                </button>
                <p class="auth-switch">No account? <a href="#" onclick="switchTab('signup')">Create one free</a></p>
            </form>

            <!-- Sign Up Form -->
            <form id="signupForm" class="auth-form" style="display:none;" onsubmit="handleSignUp(event)">
                <h2 class="auth-title">Create account</h2>
                <p class="auth-sub">Free forever — no credit card needed</p>
                <div class="auth-field">
                    <label for="suEmail">Email</label>
                    <input type="email" id="suEmail" placeholder="you@example.com" required autocomplete="email" />
                </div>
                <div class="auth-field">
                    <label for="suPassword">Password</label>
                    <input type="password" id="suPassword" placeholder="Min. 6 characters" required minlength="6"
                        autocomplete="new-password" />
                </div>
                <div class="auth-error" id="suError"></div>
                <button type="submit" class="auth-btn" id="suBtn">
                    <span id="suBtnText">Create Account</span>
                </button>
                <div class="auth-success" id="suSuccess" style="display:none;">
                    ✅ Account created! Check your email to confirm, then sign in.
                </div>
                <p class="auth-switch">Have an account? <a href="#" onclick="switchTab('signin')">Sign in</a></p>
            </form>
        </div>
    </div>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase.js"></script>
    <script>
        // If already logged in, skip to main app
        (async () => {
            const { data: { session } } = await _supabase.auth.getSession();
            if (session) window.location.href = 'index.html';
        })();

        function switchTab(tab) {
            const isSignin = tab === 'signin';
            document.getElementById('signinForm').style.display = isSignin ? '' : 'none';
            document.getElementById('signupForm').style.display = isSignin ? 'none' : '';
            document.getElementById('tabSignin').classList.toggle('active', isSignin);
            document.getElementById('tabSignup').classList.toggle('active', !isSignin);
        }

        async function handleSignIn(e) {
            e.preventDefault();
            const btn = document.getElementById('siBtn');
            const errEl = document.getElementById('siError');
            errEl.textContent = '';
            btn.disabled = true;
            document.getElementById('siBtnText').textContent = 'Signing in…';
            const email = document.getElementById('siEmail').value;
            const password = document.getElementById('siPassword').value;
            const { error } = await _supabase.auth.signInWithPassword({ email, password });
            if (error) {
                errEl.textContent = error.message;
                btn.disabled = false;
                document.getElementById('siBtnText').textContent = 'Sign In';
            } else {
                window.location.href = 'index.html';
            }
        }

        async function handleSignUp(e) {
            e.preventDefault();
            const btn = document.getElementById('suBtn');
            const errEl = document.getElementById('suError');
            errEl.textContent = '';
            btn.disabled = true;
            document.getElementById('suBtnText').textContent = 'Creating…';
            const email = document.getElementById('suEmail').value;
            const password = document.getElementById('suPassword').value;
            const { error } = await _supabase.auth.signUp({ email, password });
            if (error) {
                errEl.textContent = error.message;
                btn.disabled = false;
                document.getElementById('suBtnText').textContent = 'Create Account';
            } else {
                btn.style.display = 'none';
                document.getElementById('suSuccess').style.display = 'block';
            }
        }
    </script>
</body>

</html>